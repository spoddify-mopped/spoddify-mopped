# Contributing

Contributing and pull requests are very welcome.

This project is mainly written in TypeScript and uses Express.js for the backend and React for the frontend.
There is also some code for ESP32 boards written in C++ and a python script to connect the ESP32 boards via BLE with the Node.js backend.

## Requirements

- node v16.14.0
- yarn

There is a `.nvmrc` in the root of this project. If you use nvm you can easily run `nvm use` to configure the correct node version.

## Setup

Remove any globally installed versions of `spoddify-mopped` you may have installed on your development machine:

```bash
npm uninstall -g spoddify-mopped
```

Install yarn with:

```bash
npm i -g yarn
```

Install all node dependencies for the core server:

```bash
yarn install
yarn install:ui
```

Install all node dependencies for the ui:

```bash
yarn install:ui
```

Your local setup is ready.

## Developing

Firstly make sure you have correctly configured the `config.json` to start the application.
A detailed documentation of the config options can be found [here](https://github.com/spoddify-mopped/spoddify-mopped/wiki/Config-File).

You can either run the core (server) and the ui together or individually.

To start both and watch changes, run:

```bash
yarn watch
```

Watch core (server) only:

```bash
yarn watch:server
```

Watch ui only:

```bash
yarn watch:ui
```

## Linting and formatting

There are pre-commit hooks for linting and formatting which will be installed on `yarn install`.

You can also run them by yourself:

```bash
yarn lint
```

and

```bash
yarn format
```

To individually lint and format each package:

```bash
yarn lint:server
yarn lint:ui
```

and

```bash
yarn format:server
yarn format:ui
```

## Building

Build the project:

```
yarn build
```

This will build the core (server) and the ui. The ui build will be stored to the `public` directory.

To locally check if your build was successful, run:

```bash
yarn pack
```

and install the tarball with:

```bash
npm install -g <PATH_TO_TARBALL>
```

Make sure to remove the global installed package for further development.

## Tests

There are some unit and integration tests for the core (server):

```bash
yarn test:server
```

Make sure to run the tests before creating a pull request.

## Swagger documentation

There is a **non-autogenerated** `swagger.json`. Make sure to extend this when you are adding new api routes.
